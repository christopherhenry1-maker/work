<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Value Governance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-slate-50: #f8fafc;
            --color-slate-100: #f1f5f9;
            --color-slate-200: #e2e8f0;
            --color-slate-300: #cbd5e1;
            --color-slate-400: #94a3b8;
            --color-slate-500: #64748b;
            --color-slate-600: #475569;
            --color-slate-700: #334155;
            --color-slate-800: #1e293b;
            --color-slate-900: #0f172a;
            --color-red-50: #fef2f2;
            --color-red-100: #fee2e2;
            --color-red-600: #dc2626;
            --color-red-700: #b91c1c;
            --color-red-800: #991b1b;
            --color-green-100: #dcfce7;
            --color-green-600: #16a34a;
            --color-green-700: #15803d;
            --color-orange-100: #ffedd5;
            --color-orange-600: #ea580c;
            --color-orange-700: #c2410c;
            --color-blue-100: #dbeafe;
            --color-blue-600: #2563eb;
            --font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--color-slate-100);
            color: var(--color-slate-900);
            line-height: 1.5;
            overflow: hidden;
        }

        /* Alert Banner */
        .alert-banner {
            background-color: var(--color-red-700);
            color: white;
            padding: 0.5rem 0;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            z-index: 60;
            font-weight: 600;
            font-size: 0.875rem;
            display: none; /* Hidden by default, shown if alerts exist */
        }

        .alert-content {
            display: inline-block;
            padding-left: 100%;
            animation: scroll-left 30s linear infinite;
        }

        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* Top Navigation */
        .top-nav {
            background-color: var(--color-slate-800);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 50;
        }

        .top-nav-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            background-color: var(--color-red-700);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-title {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .logo-highlight {
            color: var(--color-red-600);
        }

        .logo-subtitle {
            font-size: 0.625rem;
            color: var(--color-slate-400);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
        }

        .page-tabs {
            display: flex;
            gap: 0.25rem;
        }

        .page-tab {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .page-tab:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }

        .page-tab.active {
            background-color: var(--color-red-700);
            color: white;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .icon-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .icon-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .user-badge {
            background-color: var(--color-red-700);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: calc(100vh - 72px);
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: white;
            border-right: 1px solid var(--color-slate-200);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar-hidden {
            transform: translateX(-100%);
            position: absolute;
            height: 100%;
            z-index: 40;
        }

        .sidebar-section {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid var(--color-slate-200);
        }

        .sidebar-calendar {
            background-color: var(--color-slate-50);
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .calendar-header h3 {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--color-slate-700);
        }

        .calendar-nav {
            display: flex;
            gap: 0.25rem;
        }

        .calendar-nav-btn {
            background: none;
            border: none;
            padding: 0.25rem;
            cursor: pointer;
            color: var(--color-slate-500);
            border-radius: 0.25rem;
            transition: all 0.2s;
        }

        .calendar-nav-btn:hover {
            background-color: var(--color-slate-200);
            color: var(--color-slate-900);
        }

        .calendar-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1px;
    background: var(--color-slate-200);
    border: 1px solid var(--color-slate-200);
}

        .calendar-day-header {
            font-size: 0.35rem;
            font-weight: 700;
            color: var(--color-slate-400);
            margin-bottom: 0.25rem;
        }

        .calendar-day {
            font-size: 0.625rem;
            height: 1.5rem;
            width: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            color: var(--color-slate-600);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .calendar-day.past {
            color: var(--color-slate-300);
            background-color: var(--color-slate-100);
        }
        
        .schedule-day.past {
            opacity: 0.4;
        }
        
        .schedule-day.past .schedule-header {
            background-color: var(--color-slate-200);
            color: var(--color-slate-400);
        }

        .calendar-day:hover {
            background-color: var(--color-slate-200);
        }

        .calendar-day.today {
            background-color: var(--color-red-700);
            color: white;
            font-weight: 700;
        }

        /* Sidebar Accordion */
        .sidebar-accordion {
            border-bottom: 1px solid var(--color-slate-100);
        }

        .accordion-header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .accordion-header:hover {
            background-color: var(--color-slate-50);
        }

        .accordion-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--color-slate-700);
        }

        .accordion-icon {
            color: var(--color-slate-400);
        }

        .chevron {
            transition: transform 0.2s;
        }

        .accordion-header.open .chevron {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-content.open {
            max-height: 500px;
            padding: 0 1rem 1rem;
        }

        /* Sidebar Links */
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.375rem;
            text-decoration: none;
            color: var(--color-slate-600);
            font-size: 0.75rem;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
        }

        .sidebar-link:hover {
            background-color: var(--color-slate-50);
            color: var(--color-slate-900);
        }

        /* Completed Items */
        .completed-item {
            display: flex;
            align-items: start;
            gap: 0.5rem;
            padding: 0.5rem;
            background-color: var(--color-slate-50);
            border: 1px solid var(--color-slate-100);
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }

        .completed-icon {
            color: var(--color-green-600);
            flex-shrink: 0;
            width: 14px;
            height: 14px;
            margin-top: 2px;
        }

        .completed-item-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-800);
            line-height: 1.2;
        }

        .completed-item-date {
            font-size: 0.75rem;
            color: var(--color-slate-500);
            margin-top: 0.25rem;
        }

        .completed-badge {
            font-size: 0.625rem;
            font-weight: 700;
            color: var(--color-green-700);
            background-color: var(--color-green-100);
            padding: 0 0.375rem;
            border-radius: 9999px;
            text-transform: uppercase;
            margin-left: 0.5rem;
        }

        /* Sidebar Footer */
        .sidebar-footer {
            margin-top: auto;
            padding: 1rem;
            border-top: 1px solid var(--color-slate-200);
            background-color: var(--color-slate-50);
        }

        .signout-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.5rem;
            background: none;
            border: none;
            color: var(--color-slate-500);
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: color 0.2s;
        }

        .signout-btn:hover {
            color: var(--color-red-700);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow: hidden;
            background-color: var(--color-slate-100);
            position: relative;
        }

        .content-scroll {
            position: absolute;
            inset: 0;
            overflow-y: auto;
            padding: 1.5rem 2rem;
        }

        .content-container {
            max-width: 1600px;
            margin: 0 auto;
            min-height: 100%;
        }

        .page-content {
            display: block;
        }

        .page-content.hidden {
            display: none;
        }

        .section-header {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-slate-500);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        /* Cards */
        .card {
            background-color: white;
            border: 1px solid var(--color-slate-200);
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--color-slate-900);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title-icon {
            color: var(--color-red-600);
        }

        /* Red Headers for Deliverables Sections */
        .deliverables-section-header {
    background: var(--color-red-700);
    color: white;
    padding: 1.25rem 1.5rem;
    border-radius: 0.5rem 0.5rem 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.deliverables-section-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

        .deliverables-section-header h2 {
            font-size: 1.125rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0;
        }

        .deliverables-section-header svg {
            color: white;
        }

        .deliverables-section-header .icon-btn {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.375rem;
            padding: 0.5rem;
        }

        .deliverables-section-header .icon-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Deliverables Table */
        .deliverables-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .deliverables-table thead {
            background-color: var(--color-slate-50);
        }

        .deliverables-table th {
            padding: 0.25rem 0.5rem;
            text-align: left;
            font-size: 0.4rem;
            font-weight: 700;
            color: var(--color-slate-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--color-slate-200);
        }

        .deliverables-table td {
            padding: 0.375rem 0.5rem;
            font-size: 0.875rem;
            border-bottom: 1px solid var(--color-slate-100);
            line-height: 1.2;
            vertical-align: middle;
        }

        .deliverables-table tbody tr {
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .deliverables-table tbody tr:hover {
            background-color: var(--color-slate-50);
        }

        .hot-indicator {
            width: 8px;
            height: 8px;
            background-color: var(--color-red-600);
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .item-description {
            font-weight: 600;
            color: var(--color-slate-900);
        }

        .item-subtext {
            font-size: 0.75rem;
            color: var(--color-slate-500);
            font-style: italic;
            margin-top: 0.25rem;
        }

        .remaining-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0.375rem;
        }

        .remaining-badge.critical {
            background-color: var(--color-red-100);
            color: var(--color-red-700);
        }

        .remaining-badge.high {
            background-color: var(--color-orange-100);
            color: var(--color-orange-700);
        }

        .remaining-badge.medium, .remaining-badge.low {
            background-color: var(--color-green-100);
            color: var(--color-green-700);
        }

        .action-link {
            color: var(--color-slate-400);
            transition: color 0.2s;
        }

        .action-link:hover {
            color: var(--color-red-600);
        }

        /* Schedule Grid */
        .schedule-wrapper {
            overflow-x: auto;
            margin: -1.5rem;
            padding: 1.5rem;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 80px repeat(10, minmax(120px, 1fr));
            gap: 1px;
            background-color: var(--color-slate-200);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            overflow: hidden;
            min-width: 1200px;
        }

        .schedule-header {
            background-color: var(--color-slate-50);
            padding: 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-700);
            text-align: center;
        }

        .schedule-time {
            background-color: white;
            padding: 0.5rem;
            font-size: 0.625rem;
            font-weight: 600;
            color: var(--color-slate-600);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .schedule-cell {
            background-color: white;
            padding: 0.125rem;
            min-height: 60px;
        }

        .schedule-item {
            background-color: var(--color-blue-100);
            border-left: 2px solid var(--color-blue-600);
            padding: 0.25rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.6rem;
            margin-bottom: 0.125rem;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1.2;
        }

        .schedule-item:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .schedule-item.deep-work {
            background-color: var(--color-blue-100);
            border-left-color: var(--color-blue-600);
        }

        .schedule-item-title {
            font-weight: 700;
            color: var(--color-slate-900);
            margin-bottom: 2px;
        }

        .schedule-item-time {
            font-size: 0.625rem;
            color: var(--color-slate-600);
        }

        /* Utilities */
        .icon {
            width: 1rem;
            height: 1rem;
        }

        .icon-sm {
            width: 0.875rem;
            height: 0.875rem;
        }

        .icon-xs {
            width: 0.75rem;
            height: 0.75rem;
        }

        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-6 { margin-top: 1.5rem; }
        .hidden { display: none !important; }

        .loading-message, .loading-spinner {
            text-align: center;
            padding: 2rem;
            color: var(--color-slate-500);
        }

        .input-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .btn-primary {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: var(--color-red-700);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary:hover {
            background-color: var(--color-red-800);
        }

        .btn-secondary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: white;
            color: var(--color-slate-700);
            border: 1px solid var(--color-slate-300);
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background-color: var(--color-slate-50);
            border-color: var(--color-slate-400);
        }

        .btn-icon-delete {
            background: none;
            border: none;
            color: var(--color-red-600);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }

        .btn-icon-delete:hover {
            background-color: var(--color-red-50);
            color: var(--color-red-700);
        }

        /* Agenda Modal Styles */
        .agenda-modal {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .agenda-modal-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .agenda-modal-content {
            position: relative;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
        }

        .agenda-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-slate-200);
        }

        .agenda-modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-slate-900);
            margin: 0;
        }

        .agenda-modal-close {
            background: none;
            border: none;
            color: var(--color-slate-400);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .agenda-modal-close:hover {
            background-color: var(--color-slate-100);
            color: var(--color-slate-900);
        }

        .agenda-modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .agenda-info {
            background-color: var(--color-slate-50);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .agenda-info-item {
            font-size: 0.875rem;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .agenda-info-item:last-child {
            margin-bottom: 0;
        }

        .agenda-info-item strong {
            color: var(--color-slate-900);
            font-weight: 600;
        }

        .agenda-section {
            margin-bottom: 1.5rem;
        }

        .agenda-section h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-slate-900);
            margin-bottom: 1rem;
        }

        .agenda-topic-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .agenda-topic-number {
            font-weight: 700;
            color: var(--color-slate-500);
            font-size: 0.875rem;
            min-width: 1.5rem;
        }

        .agenda-topic-input {
            flex: 1;
        }

        .input-hint {
            font-size: 0.75rem;
            color: var(--color-slate-500);
            margin-top: 0.5rem;
            font-style: italic;
        }

        .agenda-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.75rem;
            padding: 1.5rem;
            border-top: 1px solid var(--color-slate-200);
            background-color: var(--color-slate-50);
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
            .page-tabs {
                display: none;
            }
            .sidebar {
                position: absolute;
                z-index: 40;
                height: 100%;
            }
            .content-scroll {
                padding: 1rem;
            }
        }
    
        /* PDF Export Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.hidden {
            display: none;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-slate-200);
        }
        
        .modal-title {
            font-size: 1.125rem;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-slate-500);
        }
        
        .close-btn:hover {
            color: var(--color-slate-900);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--color-slate-200);
        }
        
        .btn-primary {
            background-color: var(--color-red-600);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary:hover {
            background-color: var(--color-red-700);
        }
        
        .btn-secondary {
            background-color: var(--color-slate-100);
            color: var(--color-slate-700);
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background-color: var(--color-slate-200);
        }
    
        /* View Toggle Buttons */
        .view-toggle-btns {
            display: flex;
            gap: 0.25rem;
            background-color: var(--color-slate-100);
            padding: 0.25rem;
            border-radius: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            color: var(--color-slate-600);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }

        .view-btn:hover {
            background-color: var(--color-slate-200);
        }

        .view-btn.active {
            background-color: var(--color-slate-800);
            color: white;
        }

        .meetings-view {
            display: block;
        }

        .meetings-view.hidden {
            display: none;
        }

        /* Calendar Grid for Month View */
        .calendar-month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: var(--color-slate-200);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .calendar-month-header {
            background-color: var(--color-slate-50);
            padding: 0.75rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-600);
            text-align: center;
            text-transform: uppercase;
        }

        .calendar-month-day {
            background-color: white;
            min-height: 100px;
            padding: 0.5rem;
            vertical-align: top;
        }

        .calendar-month-day.other-month {
            background-color: var(--color-slate-50);
        }

        .calendar-month-day.today {
            background-color: var(--color-red-50);
        }

        .calendar-day-number {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .calendar-day-number.today {
            background-color: var(--color-red-600);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-meeting-item {
            background-color: var(--color-blue-100);
            border-left: 3px solid var(--color-blue-600);
            padding: 0.25rem 0.5rem;
            margin-bottom: 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-meeting-item:hover {
            background-color: var(--color-blue-200);
        }

        /* 90 Day View */
        .ninety-day-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .month-column {
            background-color: var(--color-slate-50);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .month-column-header {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-slate-800);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--color-red-600);
        }

        .month-meeting-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem;
            background-color: white;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .month-meeting-item:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .month-meeting-date {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-slate-400);
            min-width: 30px;
        }

        .month-meeting-info {
            flex: 1;
        }

        .month-meeting-title {
            font-weight: 600;
            color: var(--color-slate-800);
            font-size: 0.875rem;
        }

        .month-meeting-time {
            font-size: 0.75rem;
            color: var(--color-slate-500);
        }

        /* Side by Side Deliverables */
        .deliverables-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1200px) {
            .deliverables-grid {
                grid-template-columns: 1fr;
            }
            .ninety-day-container {
                grid-template-columns: 1fr;
            }
        }

        /* Modal Fixes */
        .meeting-modal {
            position: fixed;
            inset: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .meeting-modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .meeting-modal-content {
            position: relative;
            z-index: 1001;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
        }

        .meeting-modal-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-slate-200);
        }

        .meeting-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-slate-900);
        }

        .meeting-modal-subtitle {
            font-size: 0.875rem;
            color: var(--color-slate-500);
            margin-top: 0.25rem;
        }

        .meeting-modal-close {
            background: none;
            border: none;
            color: var(--color-slate-400);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .meeting-modal-close:hover {
            background-color: var(--color-slate-100);
            color: var(--color-slate-900);
        }

        .meeting-modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .meeting-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.75rem;
            padding: 1.5rem;
            border-top: 1px solid var(--color-slate-200);
            background-color: var(--color-slate-50);
            border-radius: 0 0 1rem 1rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .form-select, .form-input {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background-color: white;
        }

        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: var(--color-red-600);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .linked-docs-section {
            background-color: var(--color-slate-50);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .linked-docs-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .linked-docs-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--color-slate-700);
        }

        .add-link-btn {
            font-size: 0.75rem;
            color: var(--color-red-600);
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .add-link-btn:hover {
            text-decoration: underline;
        }

    

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 1rem;
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-container {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--color-slate-200);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-slate-900);
}

.modal-close-btn {
    background: none;
    border: none;
    color: var(--color-slate-400);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    transition: all 0.2s;
}

.modal-close-btn:hover {
    background: var(--color-slate-100);
    color: var(--color-slate-600);
}

.modal-body {
    padding: 1.5rem;
    overflow-y: auto;
    flex: 1;
}

.modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--color-slate-200);
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
}

.form-group {
    margin-bottom: 1.25rem;
}

.form-row {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.25rem;
}

.form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-slate-700);
    margin-bottom: 0.5rem;
}

.form-input,
.form-textarea {
    width: 100%;
    padding: 0.625rem 0.75rem;
    border: 1px solid var(--color-slate-300);
    border-radius: 0.375rem;
    font-size: 0.875rem;
    color: var(--color-slate-900);
    transition: all 0.2s;
}

.form-input:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--color-red-600);
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.form-hint {
    margin-top: 0.375rem;
    font-size: 0.75rem;
    color: var(--color-slate-500);
}

.linked-docs-list {
    border: 1px solid var(--color-slate-200);
    border-radius: 0.375rem;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    min-height: 60px;
}

.linked-doc-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem;
    background: var(--color-slate-50);
    border-radius: 0.25rem;
    margin-bottom: 0.5rem;
}

.linked-doc-item:last-child {
    margin-bottom: 0;
}

.linked-doc-item a {
    color: var(--color-blue-600);
    text-decoration: none;
    font-size: 0.875rem;
    flex: 1;
}

.linked-doc-item a:hover {
    text-decoration: underline;
}

.remove-doc-btn {
    background: none;
    border: none;
    color: var(--color-red-600);
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0 0.5rem;
    line-height: 1;
}

.remove-doc-btn:hover {
    color: var(--color-red-700);
}

.no-docs-msg {
    color: var(--color-slate-400);
    font-size: 0.875rem;
    font-style: italic;
    text-align: center;
    padding: 1rem;
}

.btn-link {
    background: none;
    border: none;
    color: var(--color-red-600);
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    padding: 0.5rem 0;
}

.btn-link:hover {
    color: var(--color-red-700);
    text-decoration: underline;
}

.btn-danger {
    background: white;
    border: 1px solid var(--color-red-600);
    color: var(--color-red-600);
    padding: 0.625rem 1.25rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-danger:hover {
    background: var(--color-red-50);
}

.btn-danger:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

    </style>
</head>
<body>
    <div id="alertBanner" class="alert-banner">
        <div id="alertContent" class="alert-content"></div>
    </div>
    <nav class="top-nav">
        <div class="top-nav-left">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
            <div class="logo">
                <div class="logo-icon">V</div>
                <div class="logo-text">
                    <div class="logo-title">Value Governance <span class="logo-highlight">Dashboard</span></div>
                    <div class="logo-subtitle">Strategic Command Center</div>
                </div>
            </div>
            <div class="page-tabs">
                <button class="page-tab active" onclick="switchPage('overview')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Overview
                </button>
                <button class="page-tab" onclick="switchPage('meetings')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Meetings
                </button>
                <button class="page-tab" onclick="switchPage('documents')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                    </svg>
                    Documents
                </button>
            </div>
        </div>
        <div class="user-actions">
            <button class="icon-btn" title="Search">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
            </button>
            <button class="icon-btn" title="Notifications">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
            </button>
            <button class="icon-btn" title="Settings">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
            </button>
            <div class="user-badge">E2</div>
        </div>
    </nav>

    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Calendar Widget -->
            <div class="sidebar-section sidebar-calendar">
                <div class="calendar-header">
                    <h3 id="calendarMonth">January 2026</h3>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="previousMonth()">
                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <button class="calendar-nav-btn" onclick="nextMonth()">
                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="calendar-grid" style="grid-template-columns: repeat(5, 1fr);">
                    <div class="calendar-day-header">MON</div>
                    <div class="calendar-day-header">TUE</div>
                    <div class="calendar-day-header">WED</div>
                    <div class="calendar-day-header">THU</div>
                    <div class="calendar-day-header">FRI</div>
                </div>
                <div class="calendar-grid" id="calendarDays"></div>
            </div>

            <!-- Admin & Settings -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                        </svg>
                        Admin & Settings
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="adminLinks">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- KPIs & Performance -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        KPIs & Performance
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="kpiLinks">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Executive Updates -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Executive Updates
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="executiveUpdates">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Document Repository -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                        </svg>
                        Document Repository
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="documentRepoLinks">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Exec 2's Completed Items -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                        Exec 2's Completed Items
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="completedItems">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Upcoming Agendas -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        Upcoming Agendas
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content">
                    <div class="agenda-builder">
                        <label class="input-label">Select Recurring Meeting</label>
                        <select class="input-field" id="recurringMeetingSelect">
                            <option value="">-- Select Meeting --</option>
                        </select>
                        <div class="mt-3 hidden" id="agendaDateSection">
                            <label class="input-label">Select Date</label>
                            <input type="date" class="input-field" id="agendaDate">
                            <button class="btn-primary mt-2" onclick="handleCreateAgenda()">
                                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                Create Agenda
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <button class="signout-btn">
                    <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    <span>Sign Out</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-scroll">
                <div class="content-container" id="mainContent">
                    <!-- Overview Page -->
                    <div id="overviewPage" class="page-content">
                        <div class="section-header">
                            <h2 class="section-title">DASHBOARD CONTEXT</h2>
                        </div>
                        
                        <!-- Deliverables Section -->
                        <div id="deliverablesSection">
                            <div class="loading-message">Loading dashboard data...</div>
                        </div>

                        <!-- 2-Week Schedule -->
                        <div id="scheduleSection" class="mt-6">
                            <div class="loading-message">Loading schedule...</div>
                        </div>
                    </div>

                    <!-- Meetings Page -->
                    <div id="meetingsPage" class="page-content hidden">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <svg class="icon card-title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    Meetings & Scheduling
                                </h2>
                                <span style="font-size: 0.75rem; color: var(--color-slate-500);">Executive View</span>
                            </div>
                            <!-- View Toggle Buttons -->
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                                <div class="view-toggle-btns" style="display: flex; gap: 0.25rem;">
                                    <button class="view-btn active" data-view="month" onclick="switchMeetingsView('month')">Month</button>
                                    <button class="view-btn" data-view="list" onclick="switchMeetingsView('list')">List</button>
                                    <button class="view-btn" data-view="90day" onclick="switchMeetingsView('90day')">90 Day</button>
                                </div>
                                <button class="view-toggle-btn" onclick="openNewMeetingModal()" title="New Meeting">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        New
                    </button>
                            </div>
                            <!-- Month View -->
                            <div id="monthView" class="meetings-view">
                                <div id="meetingsCalendarGrid"></div>
                            </div>
                            <!-- List View -->
                            <div id="listView" class="meetings-view hidden">
                                <div id="meetingsListContent"></div>
                            </div>
                            <!-- 90 Day View -->
                            <div id="90dayView" class="meetings-view hidden">
                                <div id="meetings90DayContent"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Page -->
                    <div id="documentsPage" class="page-content hidden">
                        <div class="section-header">
                            <h2 class="section-title">DOCUMENTS & RESOURCES</h2>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                            <!-- Admin & Settings Column -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Admin & Settings</h2>
                                </div>
                                <div id="documentsAdmin">
                                    <div class="loading-message">Loading...</div>
                                </div>
                            </div>
                            
                            <!-- KPIs Column -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">KPIs & Performance</h2>
                                </div>
                                <div id="documentsKPIs">
                                    <div class="loading-message">Loading...</div>
                                </div>
                            </div>
                            
                            <!-- Executive Updates Column -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Executive Updates</h2>
                                </div>
                                <div id="documentsExecUpdates">
                                    <div class="loading-message">Loading...</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Document Repository Full Table -->
                        <div class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h2 class="card-title">Document Repository</h2>
                            </div>
                            <div class="table-wrapper">
                                <table class="deliverables-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 35%;">DESCRIPTION</th>
                                            <th style="width: 20%;">OWNER</th>
                                            <th style="width: 30%;">LINK TO MATERIALS</th>
                                            <th style="width: 15%;">COMMENTS</th>
                                        </tr>
                                    </thead>
                                    <tbody id="documentsRepository">
                                        <tr><td colspan="4" class="loading-message">Loading...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PDF Export Modal -->
    <div id="pdfExportModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Export Weekly Schedule</h3>
                <button class="close-btn" onclick="closePDFExportModal()"></button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">Week Title</label>
                    <input type="text" id="pdfWeekTitle" value="The Current Week: A Funnel from Data to Decision" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem; font-size: 0.875rem;">
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="pdfPrepMeetings" checked>
                        <span style="font-size: 0.875rem;">Include prep meeting indicators</span>
                    </label>
                </div>
                
                <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.75rem;">Select Meetings</label>
                    <div id="pdfMeetingsList" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--color-slate-200); border-radius: 0.375rem; padding: 0.75rem;">
                        <div class="loading-spinner" style="text-align: center;">Loading meetings...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 0.75rem; justify-content: flex-end; padding: 1rem 1.5rem; border-top: 1px solid var(--color-slate-200);">
                <button class="btn-secondary" onclick="closePDFExportModal()">Cancel</button>
                <button class="btn-primary" onclick="generatePDFExport()">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem; margin-right: 0.5rem;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Export PDF
                </button>
            </div>
        </div>
    </div>

<script>
// ============================================================================
// GLOBAL STATE
// ============================================================================

let dashboardData = {
    exec1Deliverables: [],
    exec2Deliverables: [],
    meetings: [],
    recurringMeetings: [],
    adminLinks: [],
    documentRepoLinks: [],
    kpiLinks: [],
    executiveUpdates: [],
    completedItems: []
};

let currentMonth = new Date();
let currentPage = 'overview';

// Agenda Builder State
let agendaModalOpen = false;
let selectedRecurringMeetingId = '';
let selectedRecurringMeetingName = '';
let selectedAgendaDate = '';
let agendaTopics = [''];
let agendaLink = '';

// ============================================================================
// INITIALIZATION
// ============================================================================

document.addEventListener('DOMContentLoaded', function() {
    console.log('Dashboard initializing...');
    initializeCalendar();
    
    // Check if google is defined (Apps Script environment) or not (Preview/Local)
    if (typeof google === 'undefined' || typeof google.script === 'undefined') {
        console.warn(' Google Apps Script environment not detected. Using mock data for preview.');
        
        // Mock Data for Preview
        const mockDashboardData = {
            exec1Deliverables: [
                { description: "Q1 Financial Review", eta: "Feb 15", owner: "Sarah M.", daysRemainingText: "14d", urgency: "medium", isHotTopic: false },
                { description: "Board Deck Finalization", eta: "Feb 02", owner: "Mike R.", daysRemainingText: "2d", urgency: "critical", isHotTopic: true }
            ],
            exec2Deliverables: [
                { description: "Compliance Audit", eta: "Mar 01", owner: "Legal", daysRemainingText: "28d", urgency: "low", isHotTopic: false }
            ],
            meetings: [
                { id: "m1", title: "Weekly Staff Sync", time: "09:00", date: new Date().toISOString().split('T')[0], category: "meeting" },
                { id: "m2", title: "Project Alpha Review", time: "14:00", date: new Date().toISOString().split('T')[0], category: "deep-work" }
            ],
            recurringMeetings: [
                { id: "r1", name: "Weekly Staff Sync" },
                { id: "r2", name: "Monthly Board Prep" }
            ],
            adminLinks: [
                { name: "Expense Portal", url: "#" },
                { name: "Travel Booking", url: "#" }
            ],
            kpiLinks: [
                { name: "Sales Dashboard", url: "#" }
            ],
            executiveUpdates: [
                { name: "Q4 Summary", url: "#", dateAdded: "Jan 15, 2026" }
            ],
            completedItems: [
                { title: "Budget Approval", dateCompleted: "Jan 20, 2026", status: "Approved" }
            ]
        };

        // Initialize mock google object
        window.google = {
            script: {
                run: {
                    withSuccessHandler: function(success) {
                        return {
                            withFailureHandler: function(failure) {
                                return {
                                    getAllDashboardData: function() {
                                        console.log(' Mocking getAllDashboardData...');
                                        setTimeout(() => success(mockDashboardData), 800);
                                    },
                                    createAgenda: function(data) {
                                        console.log(' Mocking createAgenda...', data);
                                        setTimeout(() => success({
                                            success: true,
                                            documentName: 'Agenda - ' + data.meetingName,
                                            documentUrl: '#'
                                        }), 800);
                                    }
                                };
                            }
                        };
                    }
                }
            }
        };
    }

    loadDashboardData();
    
    // Auto-refresh every 5 minutes
    setInterval(loadDashboardData, 300000);
});

// ============================================================================
// DATA LOADING
// ============================================================================

function loadDashboardData() {
    console.log('Loading dashboard data from Google Sheets...');
    
    // Set a timeout to detect if backend isn't responding
    const timeout = setTimeout(() => {
        console.error(' TIMEOUT: Backend is not responding after 30 seconds!');
        showError('Backend timeout. Please check:<br>1. Apps Script deployment is active<br>2. Sheet IDs in CONFIG are correct<br>3. Run testDataRetrieval() in Apps Script');
    }, 30000);
    
    google.script.run
        .withSuccessHandler(function(data) {
            clearTimeout(timeout);
            onDataLoaded(data);
        })
        .withFailureHandler(function(error) {
            clearTimeout(timeout);
            onDataError(error);
        })
        .getAllDashboardData();
}

function onDataLoaded(data) {
    console.log(' Data received from backend:', data);
    
    // Check if data exists
    if (!data || data === null || typeof data === 'undefined') {
        console.error(' Data is null/undefined - backend sent nothing');
        showError('Backend returned no data. Backend is working but data not reaching frontend. Try: 1) Redeploy 2) Clear cache (Ctrl+Shift+R) 3) New incognito tab');
        return;
    }
    
    // Check for error property
    if (data.error) {
        console.error(' Backend error:', data.error);
        showError('Backend error: ' + data.error);
        return;
    }
    
    console.log(' Data is valid, starting render...');
    dashboardData = data;
    
    // Render all sections with error handling
    try {
        console.log('Rendering alerts...');
        renderAlerts();
        console.log(' Alerts rendered');
    } catch (e) {
        console.error(' Error rendering alerts:', e);
    }

    try {
        console.log('Rendering deliverables...');
        renderDeliverables();
        console.log(' Deliverables rendered');
        
        // Attach click handlers to deliverable rows
        setTimeout(() => {
            attachDeliverableClickHandlers();
            console.log(' Deliverable click handlers attached');
        }, 100);
    } catch (e) {
        console.error(' Error rendering deliverables:', e);
    }
    
    try {
        console.log('Rendering schedule...');
        renderSchedule();
        console.log(' Schedule rendered');
    } catch (e) {
        console.error(' Error rendering schedule:', e);
    }
    
    try {
        console.log('Rendering sidebar links...');
        renderSidebarLinks();
        console.log(' Sidebar links rendered');
    } catch (e) {
        console.error(' Error rendering sidebar links:', e);
    }
    
    try {
        console.log('Rendering document repository...');
        renderDocumentRepository();
        console.log(' Document repository rendered');
    } catch (e) {
        console.error(' Error rendering document repository:', e);
    }
    
    try {
        console.log('Rendering recurring meetings dropdown...');
        renderRecurringMeetingsDropdown();
        console.log(' Recurring meetings dropdown rendered');
    } catch (e) {
        console.error(' Error rendering recurring meetings dropdown:', e);
    }
    
    console.log(' All rendering complete!');
}

function onDataError(error) {
    console.error('Failed to load data:', error);
    showError('Network error. Please refresh the page.');
}

function showError(message) {
    const sections = ['deliverablesSection', 'scheduleSection'];
    sections.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.innerHTML = `<div class="card" style="background-color: var(--color-red-50); border-color: var(--color-red-200); color: var(--color-red-700);">
                <p><strong>Error:</strong> ${message}</p>
            </div>`;
        }
    });
}

// ============================================================================
// DELIVERABLES RENDERING
// ============================================================================

function renderAlerts() {
    const banner = document.getElementById('alertBanner');
    const content = document.getElementById('alertContent');
    
    if (!dashboardData.alerts || dashboardData.alerts.length === 0) {
        banner.style.display = 'none';
        return;
    }
    
    banner.style.display = 'block';
    // Join alerts with a separator
    content.innerHTML = dashboardData.alerts.join(' &nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp; ');
    
    // Adjust animation speed based on content length
    const textLength = content.innerText.length;
    const duration = Math.max(20, textLength / 10); // Roughly 10 chars per second
    content.style.animationDuration = `${duration}s`;
}

function renderDeliverables() {
    const container = document.getElementById('deliverablesSection');
    
    const html = `
        <div class="deliverables-grid">
        <!-- Exec 1 Deliverables -->
        <div class="card">
            <div class="deliverables-section-header">
                <h2>
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Exec 1 Upcoming Deliverables & Hot Topics
                </h2>
                <button class="icon-btn" title="Add Deliverable" onclick="openAddItemModal('exec1')">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                </button>
            </div>
            <div class="table-wrapper">
                ${renderDeliverablesTable(dashboardData.exec1Deliverables, "exec1")}
            </div>
        </div>

        <!-- Exec 2 Governance Deliverables -->
        <div class="card">
            <div class="deliverables-section-header">
                <h2>
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                    Exec 2 Governance Upcoming Deliverables & Hot Topics
                </h2>
                <button class="icon-btn" title="Add Deliverable" onclick="openAddItemModal('exec2')">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                </button>
            </div>
            <div class="table-wrapper">
                ${renderDeliverablesTable(dashboardData.exec2Deliverables, "exec2")}
            </div>
        </div>
        </div>
    `;
    
    container.innerHTML = html;
}

function renderDeliverablesTable(deliverables) {
    if (!deliverables || deliverables.length === 0) {
        return '<p style="color: var(--color-slate-500); padding: 2rem; text-align: center;">No deliverables found.</p>';
    }
    
    return `
        <table class="deliverables-table">
            <thead>
                <tr>
                    <th style="width: 35%;">DESCRIPTION</th>
                    <th style="width: 12%;">ETA</th>
                    <th style="width: 18%;">OWNER</th>
                    <th style="width: 20%;">LINK TO MATERIALS</th>
                    <th style="width: 15%;">DAYS LEFT</th>
                </tr>
            </thead>
            <tbody>
                ${deliverables.filter(item => item.description && item.description.trim() !== '').map(item => `
                    <tr class="deliverable-row" 
                        data-id="${item.id || ''}" 
                        data-description="${item.description || ''}" 
                        data-eta="${item.eta || ''}" 
                        data-owner="${item.owner || ''}" 
                        data-link="${item.linkedMaterials || ''}" 
                        data-subtext="${item.subtext || ''}" 
                        data-hot-topic="${item.isHotTopic || false}"
                        style="cursor: pointer;">
                        <td>
                            <span class="item-description" style="display: inline;">${item.isHotTopic ? ' ' : ''}${escapeHtml(item.description)}</span>
                            ${item.subtext ? `<div class="item-subtext" style="font-style: italic; color: var(--color-slate-500); margin-top: 0.25rem; font-size: 0.75rem;">${escapeHtml(item.subtext)}</div>` : ''}
                        </td>
                        <td style="white-space: nowrap;">${item.eta && item.eta.trim() ? item.eta : ''}</td>
                        <td>${escapeHtml(item.owner) || ''}</td>
                        <td>
                            ${item.linkedMaterials ? `
                                <a href="${item.linkedMaterials}" target="_blank" class="action-link" style="color: var(--color-red-600); text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;" onclick="event.stopPropagation();">
                                    <svg class="icon" style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                    Open
                                </a>
                            ` : ''}
                        </td>
                        <td>
                            ${item.daysRemainingText ? `<span class="remaining-badge ${item.urgency === 'none' ? 'badge-text' : item.urgency}" style="font-size: 0.75rem; padding: 0.125rem 0.5rem;">${item.daysRemainingText}</span>` : ''}
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}


// Helper function to attach click handlers to deliverable rows
function attachDeliverableClickHandlers() {
    const rows = document.querySelectorAll('.deliverable-row');
    rows.forEach(row => {
        row.onclick = function() {
            const id = this.dataset.id;
            const description = this.dataset.description;
            const eta = this.dataset.eta;
            const owner = this.dataset.owner;
            const link = this.dataset.link;
            const subtext = this.dataset.subtext;
            const isHotTopic = this.dataset.hotTopic === 'true';
            
            openDeliverableModal(id, description, eta, owner, link, subtext, isHotTopic);
        };
    });
}


// ============================================================================
// SCHEDULE RENDERING
// ============================================================================

function renderSchedule() {
    const container = document.getElementById('scheduleSection');
    
    if (!dashboardData.meetings || dashboardData.meetings.length === 0) {
        container.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon card-title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        Executive Schedule - 2 Week View
                    </h2>
                </div>
                <p style="color: var(--color-slate-500); padding: 2rem; text-align: center;">No upcoming meetings found.</p>
            </div>
        `;
        return;
    }
    
    // Group meetings by date
    const meetingsByDate = {};
    dashboardData.meetings.forEach(meeting => {
        if (!meetingsByDate[meeting.date]) {
            meetingsByDate[meeting.date] = [];
        }
        meetingsByDate[meeting.date].push(meeting);
    });
    
    // Generate 2 weeks of workdays (Mon-Fri) starting from the Monday of the current week
    const today = new Date();
    const currentDay = today.getDay();
    const diff = today.getDate() - currentDay + (currentDay === 0 ? -6 : 1); // Adjust to Monday
    const monday = new Date(today.setDate(diff));
    
    const firstWeekDates = [];
    const secondWeekDates = [];
    
    for (let i = 0; i < 5; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        firstWeekDates.push(d.toISOString().split('T')[0]);
    }
    for (let i = 7; i < 12; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        secondWeekDates.push(d.toISOString().split('T')[0]);
    }
    
    const html = `
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <svg class="icon card-title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Executive Schedule - 2 Week View
                </h2>
                <button class="icon-btn" onclick="openPDFExportModal()" title="Export to PDF">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                </button>
            </div>
            <div class="schedule-wrapper">
                ${renderScheduleGrid(firstWeekDates, meetingsByDate, 'Week 1')}
                ${secondWeekDates.length > 0 ? renderScheduleGrid(secondWeekDates, meetingsByDate, 'Week 2') : ''}
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}

function renderScheduleGrid(dates, meetingsByDate, weekLabel) {
    if (dates.length === 0) return '';
    
    const dayNames = ['MON', 'TUE', 'WED', 'THU', 'FRI'];
    
    return `
        <div style="margin-bottom: 2rem;">
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem;">
                ${dates.map((date, idx) => {
                    const d = new Date(date + 'T00:00:00');
                    const dayName = dayNames[d.getDay() - 1] || dayNames[idx % 5];
                    const dayNumber = d.getDate();
                    const isToday = isDateToday(date);
                    const dayMeetings = meetingsByDate[date] || [];
                    
                    // Sort meetings by time
                    dayMeetings.sort((a, b) => (a.time || '').localeCompare(b.time || ''));

                    return `
                        <div class="schedule-day${new Date(date) < new Date(new Date().toDateString()) ? ' past' : ''}" style="background: white; border: 1px solid var(--color-slate-200); border-radius: 0; overflow: hidden; display: flex; flex-direction: column; min-height: 300px;">
                            <div style="padding: 0.5rem; text-align: center; ${isToday ? 'background-color: var(--color-red-700); color: white;' : 'background-color: var(--color-slate-50); color: var(--color-slate-600);'}">
                                <div style="font-size: 0.5rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;">${dayName}</div>
                                <div style="font-size: 1rem; font-weight: 800; margin-top: 0.15rem;">${dayNumber}</div>
                            </div>
                            <div style="padding: 0.75rem; flex: 1; display: flex; flex-direction: column; gap: 0.75rem;">
                                ${dayMeetings.length > 0 ? dayMeetings.map(m => `
                                    <div class="schedule-item ${m.category && m.category.toLowerCase().includes('work') ? 'deep-work' : ''}" 
                                         style="margin-bottom: 0; cursor: pointer; border: 1px solid var(--color-slate-100); box-shadow: 0 1px 2px rgba(0,0,0,0.05); padding: 0.5rem; border-radius: 0;"
                                         onclick="openMeetingDetails('${m.id}')">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <div style="font-weight: 700; font-size: 0.7rem; color: var(--color-slate-900); white-space: nowrap;">${m.time}</div>
                                            <div style="font-size: 0.7rem; color: var(--color-slate-600); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;">${escapeHtml(m.title)}</div>
                                            ${m.prepRequired ? `
                                                <svg class="icon-xs" style="color: var(--color-blue-600); width: 10px; height: 10px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('') : `
                                    <div style="flex: 1; display: flex; align-items: center; justify-content: center; color: var(--color-slate-300); font-size: 0.75rem; font-style: italic;">
                                        No events
                                    </div>
                                `}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function isDateToday(dateStr) {
    const today = new Date();
    const date = new Date(dateStr + 'T00:00:00');
    return date.getDate() === today.getDate() &&
           date.getMonth() === today.getMonth() &&
           date.getFullYear() === today.getFullYear();
}

// ============================================================================
// SIDEBAR LINKS RENDERING
// ============================================================================

// ============================================================================
// DOCUMENTS PAGE RENDERING
// ============================================================================

function renderDocumentsPage() {
    // Admin Links
    const adminContainer = document.getElementById('documentsAdmin');
    if (dashboardData.adminLinks && dashboardData.adminLinks.length > 0) {
        adminContainer.innerHTML = `
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                ${dashboardData.adminLinks.map(link => `
                    <a href="${link.url || '#'}" target="_blank" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--color-slate-50); border-radius: 0.5rem; text-decoration: none; color: var(--color-slate-700); transition: all 0.2s;" onmouseover="this.style.background='var(--color-slate-100)'" onmouseout="this.style.background='var(--color-slate-50)'">
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 0.875rem;">${escapeHtml(link.name)}</div>
                        </div>
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                `).join('')}
            </div>
        `;
    } else {
        adminContainer.innerHTML = '<p style="color: var(--color-slate-500); text-align: center; padding: 2rem;">No admin links configured</p>';
    }
    
    // KPI Links
    const kpiContainer = document.getElementById('documentsKPIs');
    if (dashboardData.kpiLinks && dashboardData.kpiLinks.length > 0) {
        kpiContainer.innerHTML = `
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                ${dashboardData.kpiLinks.map(link => `
                    <a href="${link.url || '#'}" target="_blank" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--color-slate-50); border-radius: 0.5rem; text-decoration: none; color: var(--color-slate-700); transition: all 0.2s;" onmouseover="this.style.background='var(--color-slate-100)'" onmouseout="this.style.background='var(--color-slate-50)'">
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 0.875rem;">${escapeHtml(link.name)}</div>
                        </div>
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                `).join('')}
            </div>
        `;
    } else {
        kpiContainer.innerHTML = '<p style="color: var(--color-slate-500); text-align: center; padding: 2rem;">No KPI links configured</p>';
    }
    
    // Executive Updates
    const updatesContainer = document.getElementById('documentsExecUpdates');
    if (dashboardData.executiveUpdates && dashboardData.executiveUpdates.length > 0) {
        updatesContainer.innerHTML = `
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                ${dashboardData.executiveUpdates.map(update => `
                    <a href="${update.url || update.link || '#'}" target="_blank" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--color-slate-50); border-radius: 0.5rem; text-decoration: none; color: var(--color-slate-700); transition: all 0.2s;" onmouseover="this.style.background='var(--color-slate-100)'" onmouseout="this.style.background='var(--color-slate-50)'">
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 0.875rem;">${escapeHtml(update.name)}</div>
                            ${update.dateAdded ? `<div style="font-size: 0.625rem; color: var(--color-slate-400);">${update.dateAdded}</div>` : ''}
                        </div>
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                `).join('')}
            </div>
        `;
    } else {
        updatesContainer.innerHTML = '<p style="color: var(--color-slate-500); text-align: center; padding: 2rem;">No updates available</p>';
    }
    
    // Document Repository Table (columns A, C, D, G = Description, Owner, Link, Comments)
    const docRepoTable = document.getElementById('documentsRepository');
    if (dashboardData.documentRepoLinks && dashboardData.documentRepoLinks.length > 0) {
        docRepoTable.innerHTML = dashboardData.documentRepoLinks.map(doc => `
            <tr style="cursor: pointer;">
                <td>
                    <div style="font-weight: 600;">${escapeHtml(doc.name || doc.description)}</div>
                    ${doc.comment ? `<div style="font-size: 0.75rem; color: var(--color-slate-500); margin-top: 0.25rem;">${escapeHtml(doc.comment)}</div>` : ''}
                </td>
                <td>${escapeHtml(doc.owner) || ''}</td>
                <td>
                    ${doc.url || doc.link ? `
                        <a href="${doc.url || doc.link}" target="_blank" style="color: var(--color-red-600); text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;" onclick="event.stopPropagation();">
                            <svg class="icon" style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                            </svg>
                            Open
                        </a>
                    ` : ''}
                </td>
                <td>${doc.comment ? `<span style="font-size: 0.875rem;">${escapeHtml(doc.comment)}</span>` : ''}</td>
            </tr>
        `).join('');
    } else {
        docRepoTable.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem; color: var(--color-slate-500);">No documents found</td></tr>';
    }
}

function renderSidebarLinks() {
    // Admin Links
    const adminContainer = document.getElementById('adminLinks');
    if (dashboardData.adminLinks && dashboardData.adminLinks.length > 0) {
        adminContainer.innerHTML = dashboardData.adminLinks.map(link => `
            <a href="${link.url || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                ${escapeHtml(link.name)}
            </a>
        `).join('');
    } else {
        adminContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No links configured</p>';
    }
    
    // KPI Links
    const kpiContainer = document.getElementById('kpiLinks');
    if (dashboardData.kpiLinks && dashboardData.kpiLinks.length > 0) {
        kpiContainer.innerHTML = dashboardData.kpiLinks.map(link => `
            <a href="${link.url || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                ${escapeHtml(link.name)}
            </a>
        `).join('');
    } else {
        kpiContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No links configured</p>';
    }
    
    // Executive Updates
    const updatesContainer = document.getElementById('executiveUpdates');
    if (dashboardData.executiveUpdates && dashboardData.executiveUpdates.length > 0) {
        updatesContainer.innerHTML = dashboardData.executiveUpdates.map(update => `
            <a href="${update.url || update.link || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                </svg>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">${escapeHtml(update.name)}</div>
                    ${update.dateAdded ? `<div style="font-size: 0.625rem; color: var(--color-slate-400);">${update.dateAdded}</div>` : ''}
                </div>
            </a>
        `).join('');
    } else {
        updatesContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No updates yet</p>';
    }
    
    // Completed Items
    const completedContainer = document.getElementById('completedItems');
    if (dashboardData.completedItems && dashboardData.completedItems.length > 0) {
        completedContainer.innerHTML = dashboardData.completedItems.map(item => `
            <div class="completed-item">
                <svg class="completed-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <div style="flex: 1;">
                    <div class="completed-item-title">${escapeHtml(item.title)}</div>
                    <div class="completed-item-date">${item.dateCompleted}${item.status ? `<span class="completed-badge">${item.status}</span>` : ''}</div>
                </div>
            </div>
        `).join('');
    } else {
        completedContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No completed items yet</p>';
    }
    
    // Document Repository Links (limit to first 10)
    const docRepoContainer = document.getElementById('documentRepoLinks');
    if (dashboardData.documentRepoLinks && dashboardData.documentRepoLinks.length > 0) {
        docRepoContainer.innerHTML = dashboardData.documentRepoLinks.slice(0, 10).map(doc => `
            <a href="${doc.url || doc.link || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">${escapeHtml(doc.name || doc.description)}</div>
                    ${doc.owner ? `<div style="font-size: 0.625rem; color: var(--color-slate-400);">Owner: ${escapeHtml(doc.owner)}</div>` : ''}
                </div>
            </a>
        `).join('');
    } else {
        docRepoContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No documents available</p>';
    }
}

// ============================================================================
// DOCUMENT REPOSITORY RENDERING
// ============================================================================

function renderDocumentRepository() {
    const container = document.getElementById('documentRepository');
    
    const html = `
        <div class="mt-3">
            ${renderDocSection('Admin & Settings', dashboardData.adminLinks)}
            ${renderDocSection('KPIs & Performance', dashboardData.kpiLinks)}
            ${renderDocSection('Executive Updates', dashboardData.executiveUpdates)}
            ${renderDocSection('Document Repository', dashboardData.documentRepoLinks)}
        </div>
    `;
    
    container.innerHTML = html;
}

function renderDocSection(title, items) {
    return `
        <div style="margin-bottom: 2rem;">
            <h3 style="font-size: 1rem; font-weight: 700; color: var(--color-slate-800); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--color-red-600); display: inline-block;">${title}</h3>
            <table class="deliverables-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>ETA</th>
                        <th>Owner</th>
                        <th>Link</th>
                        <th>Comment</th>
                    </tr>
                </thead>
                <tbody>
                    ${items && items.length > 0 ? items.map(item => `
                        <tr>
                            <td class="item-description">${escapeHtml(item.description || item.name || item.title)}</td>
                            <td>${escapeHtml(item.eta || '')}</td>
                            <td>${escapeHtml(item.owner || '')}</td>
                            <td>
                                <a href="${escapeHtml(item.link || item.url || '#')}" target="_blank" class="action-link">
                                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                </a>
                            </td>
                            <td style="font-size: 0.75rem; color: var(--color-slate-500);">${escapeHtml(item.comment || '')}</td>
                        </tr>
                    `).join('') : '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--color-slate-400);">No items found</td></tr>'}
                </tbody>
            </table>
        </div>
    `;
}

function renderMeetingsScheduling() {
    const container = document.getElementById('meetingsSchedulingContent');
    const meetings = dashboardData.meetings || [];
    
    let html = `
        <table class="deliverables-table">
            <thead>
                <tr>
                    <th>Meeting Name</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Attendees</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                ${meetings.length > 0 ? meetings.map(m => `
                    <tr>
                        <td class="item-description">${escapeHtml(m.title)}</td>
                        <td>${m.dateFormatted}</td>
                        <td>${m.time}</td>
                        <td style="font-size: 0.75rem;">${escapeHtml(m.attendees)}</td>
                        <td>
                            <button class="btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="openMeetingDetails('${m.id}')">Details</button>
                        </td>
                    </tr>
                `).join('') : '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--color-slate-400);">No meetings scheduled</td></tr>'}
            </tbody>
        </table>
    `;
    container.innerHTML = html;
}

// ============================================================================
// CALENDAR WIDGET
// ============================================================================

function initializeCalendar() {
    renderCalendar(currentMonth);
}

function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    
    // Update header
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'];
    document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
    
    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    const container = document.getElementById('calendarDays');
    let html = '';
    
    // Add empty cells for days before month starts
    for (let i = 0; i < firstDay; i++) {
        html += '<div class="calendar-day" style="visibility: hidden;"></div>';
    }
    
    // Add days of month
    const today = new Date();
    for (let day = 1; day <= daysInMonth; day++) {
        const currentDate = new Date(year, month, day);
        const dayOfWeek = currentDate.getDay();
        
        // Skip weekends (0 = Sunday, 6 = Saturday)
        if (dayOfWeek === 0 || dayOfWeek === 6) continue;
        
        const isToday = day === today.getDate() && 
                       month === today.getMonth() && 
                       year === today.getFullYear();
        const isPast = currentDate < today && !isToday;
        html += `<div class="calendar-day${isToday ? ' today' : ''}${isPast ? ' past' : ''}">${day}</div>`;
    }
    
    container.innerHTML = html;
}

function previousMonth() {
    currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1);
    renderCalendar(currentMonth);
}

function nextMonth() {
    currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1);
    renderCalendar(currentMonth);
}

// ============================================================================
// UI INTERACTIONS
// ============================================================================

function switchPage(pageName) {
    currentPage = pageName;
    
    // Hide all pages
    document.querySelectorAll('.page-content').forEach(page => {
        page.classList.add('hidden');
    });
    
    // Show selected page
    document.getElementById(pageName + 'Page').classList.remove('hidden');
    
    // Update tab active state
    document.querySelectorAll('.page-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.closest('.page-tab').classList.add('active');
    
    // Load page-specific data if needed
    if (pageName === 'documents') {
        renderDocumentsPage();
    }
}

function toggleAccordion(button) {
    const content = button.nextElementSibling;
    const isOpen = content.classList.contains('open');
    
    if (isOpen) {
        content.classList.remove('open');
        button.classList.remove('open');
    } else {
        content.classList.add('open');
        button.classList.add('open');
    }
}

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('sidebar-hidden');
}

function openMeetingDetails(meetingId) {
    // Close any existing modal first
    closeMeetingModal();
    
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    if (!meeting) {
        console.error('Meeting not found:', meetingId);
        return;
    }

    const modalHtml = `
        <div id="meetingModal" class="modal-overlay">
            <div class="modal-container" style="max-width: 600px; width: 90%;">
                <div class="modal-header">
                    <h2 class="modal-title">Edit Meeting</h2>
                    <button class="modal-close-btn" onclick="closeMeetingModal()" type="button">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="modal-body">
                    <!-- Meeting Title -->
                    <div class="form-group">
                        <label class="form-label">Meeting Title</label>
                        <input type="text" id="meetingTitle" class="form-input" value="${escapeHtml(meeting.title || '')}" />
                    </div>

                    <!-- Date and Time -->
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Date</label>
                            <input type="date" id="meetingDate" class="form-input" value="${meeting.date || ''}" />
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Time</label>
                            <input type="time" id="meetingTime" class="form-input" value="${meeting.time || ''}" />
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="meetingDescription" class="form-textarea" rows="3">${escapeHtml(meeting.description || '')}</textarea>
                    </div>

                    <!-- Meeting Type -->
                    <div class="form-group">
                        <label class="form-label">Meeting Type</label>
                        <select id="meetingType" class="form-input">
                            <option value="Operational" ${meeting.meetingType === 'Operational' ? 'selected' : ''}>Operational</option>
                            <option value="Strategic" ${meeting.meetingType === 'Strategic' ? 'selected' : ''}>Strategic</option>
                            <option value="Tactical" ${meeting.meetingType === 'Tactical' ? 'selected' : ''}>Tactical</option>
                            <option value="Review" ${meeting.meetingType === 'Review' ? 'selected' : ''}>Review</option>
                            <option value="Planning" ${meeting.meetingType === 'Planning' ? 'selected' : ''}>Planning</option>
                        </select>
                    </div>

                    <!-- Owner/Organizer -->
                    <div class="form-group">
                        <label class="form-label">Organizer</label>
                        <input type="text" id="meetingOrganizer" class="form-input" value="${escapeHtml(meeting.organizer || '')}" />
                    </div>

                    <!-- Link Prep Session -->
                    <div class="form-group">
                        <label class="form-label">Link Prep Session</label>
                        <select id="prepMeetingSelect" class="form-input">
                            <option value="">-- Select a prep meeting --</option>
                            ${dashboardData.meetings
                                .filter(m => m.id !== meeting.id)
                                .map(m => `<option value="${m.id}" ${meeting.prepMeetingId === m.id ? 'selected' : ''}>${escapeHtml(m.title)} (${m.dateFormatted})</option>`)
                                .join('')}
                        </select>
                        <p class="form-hint">Optional: Link a preparation meeting</p>
                    </div>

                    <!-- Meeting Link/URL -->
                    <div class="form-group">
                        <label class="form-label">Meeting Link (Zoom, Teams, etc.)</label>
                        <input type="url" id="meetingLink" class="form-input" value="${escapeHtml(meeting.link || '')}" placeholder="https://" />
                    </div>

                    <!-- Notes & Commentary -->
                    <div class="form-group">
                        <label class="form-label"> Notes & Commentary</label>
                        <textarea id="meetingNotes" class="form-textarea" rows="4" placeholder="Add meeting notes, agenda items, or commentary...">${escapeHtml(meeting.notes || '')}</textarea>
                    </div>

                    <!-- Linked Documents -->
                    <div class="form-group">
                        <label class="form-label"> Linked Documents</label>
                        <div id="linkedDocsList" class="linked-docs-list">
                            ${meeting.linkedDocuments && meeting.linkedDocuments.length > 0 
                                ? meeting.linkedDocuments.map((doc, idx) => `
                                    <div class="linked-doc-item">
                                        <a href="${doc.url}" target="_blank">${escapeHtml(doc.name)}</a>
                                        <button type="button" onclick="removeLinkedDoc(${idx})" class="remove-doc-btn"></button>
                                    </div>
                                `).join('')
                                : '<p class="no-docs-msg">No documents linked yet.</p>'
                            }
                        </div>
                        <button type="button" onclick="addLinkedDocument()" class="btn-link">+ Add Link</button>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeMeetingModal()">Cancel</button>
                    <button type="button" class="btn-danger" onclick="deleteMeeting('${meeting.id}')">Delete</button>
                    <button type="button" class="btn-primary" onclick="saveMeetingChanges('${meeting.id}')">Save Changes</button>
                </div>
            </div>
        </div>
    `;
    
    // Insert modal
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    document.body.style.overflow = 'hidden';
    
    // Add click outside to close
    setTimeout(() => {
        const overlay = document.getElementById('meetingModal');
        if (overlay) {
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeMeetingModal();
                }
            });
        }
    }, 100);
    
    // Add ESC key to close
    document.addEventListener('keydown', handleModalEscape);
}

function closeMeetingModal() {
    const modal = document.getElementById('meetingModal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = '';
    document.removeEventListener('keydown', handleModalEscape);
}

function saveMeetingPrep(meetingId) {
    const prepId = document.getElementById('prepMeetingSelect').value;
    if (!prepId) {
        closeMeetingModal();
        return;
    }
    
    // In a real app, this would call the backend. For now, we'll simulate it.
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    const prepMeeting = dashboardData.meetings.find(m => m.id === prepId);
    
    alert(`Linked "${prepMeeting.title}" as a prep meeting for "${meeting.title}".\n\n(Note: This change will be saved to the spreadsheet in the next update)`);
    closeMeetingModal();
}

function handleModalEscape(e) {
    if (e.key === 'Escape') {
        closeMeetingModal();
    }
}

function saveMeetingChanges(meetingId) {
    const data = {
        id: meetingId,
        title: document.getElementById('meetingTitle').value.trim(),
        date: document.getElementById('meetingDate').value,
        time: document.getElementById('meetingTime').value,
        description: document.getElementById('meetingDescription').value.trim(),
        meetingType: document.getElementById('meetingType').value,
        organizer: document.getElementById('meetingOrganizer').value.trim(),
        prepMeetingId: document.getElementById('prepMeetingSelect').value,
        link: document.getElementById('meetingLink').value.trim(),
        notes: document.getElementById('meetingNotes').value.trim()
    };
    
    if (!data.title) {
        alert('Please enter a meeting title');
        return;
    }
    
    if (!data.date) {
        alert('Please select a date');
        return;
    }
    
    const saveBtn = event.target;
    const originalText = saveBtn.textContent;
    saveBtn.textContent = 'Saving...';
    saveBtn.disabled = true;
    
    google.script.run
        .withSuccessHandler(function(result) {
            if (result.success) {
                alert('Meeting updated successfully!');
                closeMeetingModal();
                loadDashboardData();
            } else {
                alert('Error updating meeting: ' + result.error);
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        })
        .withFailureHandler(function(error) {
            alert('Error saving changes: ' + error.message);
            saveBtn.textContent = originalText;
            saveBtn.disabled = false;
        })
        .updateMeeting(data);
}

function deleteMeeting(meetingId) {
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    if (!meeting) return;
    
    if (!confirm(`Are you sure you want to delete "${meeting.title}"?\n\nThis action cannot be undone.`)) {
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(result) {
            if (result.success) {
                alert('Meeting deleted successfully!');
                closeMeetingModal();
                loadDashboardData();
            } else {
                alert('Error deleting meeting: ' + result.error);
            }
        })
        .withFailureHandler(function(error) {
            alert('Error deleting meeting: ' + error.message);
        })
        .deleteMeeting(meetingId);
}

function addLinkedDocument() {
    const name = prompt('Enter document name:');
    if (!name) return;
    
    const url = prompt('Enter document URL:');
    if (!url) return;
    
    const docsList = document.getElementById('linkedDocsList');
    const noDocsMsg = docsList.querySelector('.no-docs-msg');
    if (noDocsMsg) noDocsMsg.remove();
    
    const docItem = document.createElement('div');
    docItem.className = 'linked-doc-item';
    docItem.innerHTML = `
        <a href="${escapeHtml(url)}" target="_blank">${escapeHtml(name)}</a>
        <button type="button" onclick="this.parentElement.remove()" class="remove-doc-btn"></button>
    `;
    docsList.appendChild(docItem);
}

function removeLinkedDoc(index) {
    if (confirm('Remove this linked document?')) {
        event.target.closest('.linked-doc-item').remove();
    }
}


function createAgenda() {
    const select = document.getElementById('recurringMeetingSelect');
    const date = document.getElementById('agendaDate');
    
    if (!select.value || !date.value) {
        alert('Please select a meeting and date');
        return;
    }
    
    alert(`Creating agenda for ${select.options[select.selectedIndex].text} on ${date.value}...\n\nThis feature would create a new agenda document.`);
}

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Show recurring meeting select when something is selected
document.addEventListener('DOMContentLoaded', function() {
    const select = document.getElementById('recurringMeetingSelect');
    if (select) {
        select.addEventListener('change', function() {
            const section = document.getElementById('agendaDateSection');
            if (this.value) {
                section.classList.remove('hidden');
                selectedRecurringMeetingId = this.value;
                selectedRecurringMeetingName = this.options[this.selectedIndex].text;
            } else {
                section.classList.add('hidden');
            }
        });
    }
});

// ============================================================================
// AGENDA BUILDER FUNCTIONS
// ============================================================================

/**
 * Render recurring meetings dropdown
 */
function renderRecurringMeetingsDropdown() {
    const select = document.getElementById('recurringMeetingSelect');
    if (!select) return;
    
    const meetings = dashboardData.recurringMeetings || [];
    
    let html = '<option value="">-- Select Meeting --</option>';
    meetings.forEach(meeting => {
        html += `<option value="${escapeHtml(meeting.id)}">${escapeHtml(meeting.name)}</option>`;
    });
    
    select.innerHTML = html;
}

/**
 * Open the agenda creation modal
 */
function handleCreateAgenda() {
    const meetingSelect = document.getElementById('recurringMeetingSelect');
    const dateInput = document.getElementById('agendaDate');
    
    if (!meetingSelect.value) {
        alert('Please select a recurring meeting');
        return;
    }
    
    if (!dateInput.value) {
        alert('Please select a date for the agenda');
        return;
    }
    
    selectedRecurringMeetingId = meetingSelect.value;
    selectedRecurringMeetingName = meetingSelect.options[meetingSelect.selectedIndex].text;
    selectedAgendaDate = dateInput.value;
    agendaTopics = [''];
    agendaLink = '';
    
    openAgendaModal();
}

/**
 * Open the agenda modal
 */
function openAgendaModal() {
    agendaModalOpen = true;
    
    // Create modal HTML
    const modalHtml = `
        <div id="agendaModal" class="agenda-modal">
            <div class="agenda-modal-overlay" onclick="closeAgendaModal()"></div>
            <div class="agenda-modal-content">
                <div class="agenda-modal-header">
                    <h2>Create Agenda</h2>
                    <button class="agenda-modal-close" onclick="closeAgendaModal()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="agenda-modal-body">
                    <div class="agenda-info">
                        <div class="agenda-info-item">
                            <strong>Meeting:</strong> ${escapeHtml(selectedRecurringMeetingName)}
                        </div>
                        <div class="agenda-info-item">
                            <strong>Date:</strong> ${formatDate(selectedAgendaDate)}
                        </div>
                    </div>
                    
                    <div class="agenda-section">
                        <h3>Agenda Topics</h3>
                        <div id="agendaTopicsList"></div>
                        <button class="btn-secondary" onclick="addAgendaTopic()">
                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Add Topic
                        </button>
                    </div>
                    
                    <div class="agenda-section">
                        <label class="input-label">Meeting Invite Link</label>
                        <input type="url" 
                               class="input-field" 
                               id="agendaLinkInput" 
                               placeholder="Paste calendar invite or meeting URL..."
                               value="${escapeHtml(agendaLink)}"
                               oninput="agendaLink = this.value">
                        <p class="input-hint">Link to the existing calendar event for easy access</p>
                    </div>
                </div>
                
                <div class="agenda-modal-footer">
                    <button class="btn-secondary" onclick="closeAgendaModal()">Cancel</button>
                    <button class="btn-primary" onclick="handleSaveAgenda()">Save Agenda</button>
                </div>
            </div>
        </div>
    `;
    
    // Add to body
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Render topics
    renderAgendaTopics();
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
}

/**
 * Close the agenda modal
 */
function closeAgendaModal() {
    agendaModalOpen = false;
    const modal = document.getElementById('agendaModal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = '';
}

/**
 * Render agenda topics list
 */
function renderAgendaTopics() {
    const container = document.getElementById('agendaTopicsList');
    if (!container) return;
    
    let html = '';
    agendaTopics.forEach((topic, index) => {
        html += `
            <div class="agenda-topic-item">
                <span class="agenda-topic-number">${index + 1}.</span>
                <input type="text" 
                       class="input-field agenda-topic-input" 
                       placeholder="Enter discussion topic..."
                       value="${escapeHtml(topic)}"
                       oninput="updateAgendaTopic(${index}, this.value)">
                ${agendaTopics.length > 1 ? `
                    <button class="btn-icon-delete" onclick="removeAgendaTopic(${index})" title="Remove topic">
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </button>
                ` : ''}
            </div>
        `;
    });
    
    container.innerHTML = html;
}

/**
 * Add a new agenda topic
 */
function addAgendaTopic() {
    agendaTopics.push('');
    renderAgendaTopics();
}

/**
 * Update agenda topic at index
 */
function updateAgendaTopic(index, value) {
    agendaTopics[index] = value;
}

/**
 * Remove agenda topic at index
 */
function removeAgendaTopic(index) {
    agendaTopics.splice(index, 1);
    renderAgendaTopics();
}

/**
 * Save the agenda (creates Google Doc)
 */
function handleSaveAgenda() {
    // Filter out empty topics
    const topics = agendaTopics.filter(t => t && t.trim() !== '');
    
    if (topics.length === 0) {
        alert('Please add at least one agenda topic');
        return;
    }
    
    // Show loading state
    const saveBtn = document.querySelector('.agenda-modal-footer .btn-primary');
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<span style="opacity: 0.7;">Creating agenda...</span>';
    saveBtn.disabled = true;
    
    // Call backend to create Google Doc
    google.script.run
        .withSuccessHandler(function(result) {
            if (result.success) {
                closeAgendaModal();
                
                // Reset form
                agendaTopics = [''];
                agendaLink = '';
                document.getElementById('recurringMeetingSelect').value = '';
                document.getElementById('agendaDate').value = '';
                document.getElementById('agendaDateSection').classList.add('hidden');
                
                // Show success message
                alert(` Agenda created successfully!\n\nDocument: ${result.documentName}\n\nOpening in new tab...`);
                
                // Open the document
                window.open(result.documentUrl, '_blank');
            } else {
                alert('Error creating agenda: ' + result.error);
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        })
        .withFailureHandler(function(error) {
            alert('Failed to create agenda: ' + error);
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        })
        .createAgenda({
            meetingName: selectedRecurringMeetingName,
            meetingDate: formatDate(selectedAgendaDate),
            topics: topics,
            meetingLink: agendaLink
        });
}

/**
 * Format date for display
 */
function formatDate(dateStr) {
    const date = new Date(dateStr + 'T00:00:00');
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
}

/**
 * Get next occurrence of a recurring meeting (helper function)
 */
function getNextDate(frequency) {
    const today = new Date();
    
    if (frequency && frequency.toLowerCase().includes('weekly')) {
        // Next week same day
        const nextWeek = new Date(today);
        nextWeek.setDate(today.getDate() + 7);
        return nextWeek.toISOString().split('T')[0];
    } else if (frequency && frequency.toLowerCase().includes('monthly')) {
        // Next month same date
        const nextMonth = new Date(today);
        nextMonth.setMonth(today.getMonth() + 1);
        return nextMonth.toISOString().split('T')[0];
    }
    
    // Default to tomorrow
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    return tomorrow.toISOString().split('T')[0];
}

// ============================================================================
// MEETINGS VIEW SWITCHING
// ============================================================================

let currentMeetingsView = 'month';
let meetingsCalendarMonth = new Date();

function switchMeetingsView(view) {
    currentMeetingsView = view;
    
    // Update button states
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.view === view) {
            btn.classList.add('active');
        }
    });
    
    // Show/hide views
    document.querySelectorAll('.meetings-view').forEach(v => v.classList.add('hidden'));
    const viewEl = document.getElementById(view + 'View');
    if (viewEl) viewEl.classList.remove('hidden');
    
    // Render the appropriate view
    if (view === 'month') {
        renderMeetingsCalendar();
    } else if (view === 'list') {
        renderMeetingsList();
    } else if (view === '90day') {
        render90DayView();
    }
}

function renderMeetingsCalendar() {
    const container = document.getElementById('meetingsCalendarGrid');
    if (!container) return;
    
    const meetings = dashboardData.meetings || [];
    
    const year = meetingsCalendarMonth.getFullYear();
    const month = meetingsCalendarMonth.getMonth();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const totalDays = lastDay.getDate();
    
    const today = new Date();
    const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
    
    // Group meetings by date
    const meetingsByDate = {};
    meetings.forEach(m => {
        const dateKey = m.date;
        if (!meetingsByDate[dateKey]) meetingsByDate[dateKey] = [];
        meetingsByDate[dateKey].push(m);
    });
    
    let html = `
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
            <button class="calendar-nav-btn" onclick="navigateMeetingsCalendar(-1)">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            <h3 style="font-size: 1.25rem; font-weight: 700; color: var(--color-slate-800);">${monthNames[month]} ${year}</h3>
            <button class="calendar-nav-btn" onclick="navigateMeetingsCalendar(1)">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
        <div class="calendar-month-grid" style="grid-template-columns: repeat(5, 1fr);">
            <div class="calendar-month-header">Mon</div>
            <div class="calendar-month-header">Tue</div>
            <div class="calendar-month-header">Wed</div>
            <div class="calendar-month-header">Thu</div>
            <div class="calendar-month-header">Fri</div>
    `;
    
    // Find the first Monday of the display (may be in previous month)
    let firstDayOfWeek = firstDay.getDay(); // 0=Sun, 1=Mon, etc.
    // Adjust so Monday = 0
    let mondayOffset = (firstDayOfWeek === 0) ? -6 : 1 - firstDayOfWeek;
    
    // Previous month days (only weekdays before the 1st)
    const prevMonth = new Date(year, month, 0);
    const prevMonthDays = prevMonth.getDate();
    for (let offset = mondayOffset; offset < 0; offset++) {
        const prevDay = prevMonthDays + offset + 1;
        html += `<div class="calendar-month-day other-month"><span class="calendar-day-number" style="color: var(--color-slate-300);">${prevDay}</span></div>`;
    }
    
    // Current month days (weekdays only)
    for (let day = 1; day <= totalDays; day++) {
        const currentDate = new Date(year, month, day);
        const dayOfWeek = currentDate.getDay();
        
        // Skip weekends (0 = Sunday, 6 = Saturday)
        if (dayOfWeek === 0 || dayOfWeek === 6) continue;
        
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const isToday = isCurrentMonth && today.getDate() === day;
        const dayMeetings = meetingsByDate[dateStr] || [];
        
        html += `<div class="calendar-month-day${isToday ? ' today' : ''}">
            <span class="calendar-day-number${isToday ? ' today' : ''}">${day}</span>`;
        
        dayMeetings.slice(0, 3).forEach(m => {
            html += `<div class="calendar-meeting-item" onclick="openMeetingModal('${m.id}')">
                <span style="font-weight: 600;">${m.time}</span> ${escapeHtml(m.title.substring(0, 15))}${m.title.length > 15 ? '...' : ''}
            </div>`;
        });
        
        if (dayMeetings.length > 3) {
            html += `<div style="font-size: 0.65rem; color: var(--color-slate-500); text-align: center;">+${dayMeetings.length - 3} more</div>`;
        }
        
        html += `</div>`;
    }
    
    // Calculate how many weekday cells we have so far
    let weekdayCells = 0;
    for (let offset = mondayOffset; offset < 0; offset++) weekdayCells++;
    for (let day = 1; day <= totalDays; day++) {
        const currentDate = new Date(year, month, day);
        const dayOfWeek = currentDate.getDay();
        if (dayOfWeek !== 0 && dayOfWeek !== 6) weekdayCells++;
    }
    
    // Fill remaining cells to complete the grid (5 columns x ~5 rows = ~25 cells)
    const targetCells = Math.ceil(weekdayCells / 5) * 5;
    for (let i = 1; weekdayCells < targetCells; i++) {
        html += `<div class="calendar-month-day other-month"><span class="calendar-day-number" style="color: var(--color-slate-300);">${i}</span></div>`;
        weekdayCells++;
    }
    
    html += `</div>`;
    container.innerHTML = html;
}

function navigateMeetingsCalendar(direction) {
    meetingsCalendarMonth.setMonth(meetingsCalendarMonth.getMonth() + direction);
    renderMeetingsCalendar();
}

function renderMeetingsList() {
    const container = document.getElementById('meetingsListContent');
    if (!container) return;
    
    const meetings = dashboardData.meetings || [];
    
    if (meetings.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--color-slate-500); padding: 2rem;">No meetings scheduled</p>';
        return;
    }
    
    const sorted = [...meetings].sort((a, b) => new Date(a.date) - new Date(b.date));
    
    let html = `
        <table class="deliverables-table">
            <thead>
                <tr>
                    <th style="width: 5%;"></th>
                    <th style="width: 15%;">DATE & TIME</th>
                    <th style="width: 30%;">TITLE</th>
                    <th style="width: 15%;">FREQUENCY</th>
                    <th style="width: 15%;">ATTENDEES</th>
                    <th style="width: 10%;">PREP</th>
                    <th style="width: 10%;">DELIVERABLES</th>
                    <th style="width: 5%;">ACTIONS</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    sorted.forEach(m => {
        html += `
            <tr onclick="openMeetingModal('${m.id}')" style="cursor: pointer;">
                <td><input type="checkbox" onclick="event.stopPropagation();"></td>
                <td>
                    <div style="font-weight: 600;">${m.dateFormatted || m.date}</div>
                    <div style="font-size: 0.75rem; color: var(--color-slate-500);">${m.time}</div>
                </td>
                <td>
                    <div class="item-description">${escapeHtml(m.title)}</div>
                    ${m.category ? `<div style="font-size: 0.7rem; color: var(--color-slate-400);">${m.category}</div>` : ''}
                </td>
                <td>${m.frequency || 'One-time'}</td>
                <td style="font-size: 0.75rem;">${escapeHtml(m.attendees || '')}</td>
                <td>
                    ${m.prepRequired ? '<span class="remaining-badge medium">Required</span>' : '<span style="color: var(--color-slate-400);">None</span>'}
                </td>
                <td>${m.deliverables || ''}</td>
                <td>
                    <a href="${m.link || '#'}" target="_blank" class="action-link" onclick="event.stopPropagation();">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                </td>
            </tr>
        `;
    });
    
    html += `</tbody></table>`;
    container.innerHTML = html;
}

function render90DayView() {
    const container = document.getElementById('meetings90DayContent');
    if (!container) return;
    
    const meetings = dashboardData.meetings || [];
    
    const today = new Date();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    
    const months = [];
    for (let i = 0; i < 3; i++) {
        const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
        months.push({
            year: d.getFullYear(),
            month: d.getMonth(),
            name: monthNames[d.getMonth()] + ' ' + d.getFullYear()
        });
    }
    
    const meetingsByMonth = {};
    meetings.forEach(m => {
        const d = new Date(m.date);
        const key = `${d.getFullYear()}-${d.getMonth()}`;
        if (!meetingsByMonth[key]) meetingsByMonth[key] = [];
        meetingsByMonth[key].push(m);
    });
    
    let html = '<div class="ninety-day-container">';
    
    months.forEach(mo => {
        const key = `${mo.year}-${mo.month}`;
        const monthMeetings = meetingsByMonth[key] || [];
        
        html += `
            <div class="month-column">
                <div class="month-column-header">${mo.name}</div>
        `;
        
        if (monthMeetings.length === 0) {
            html += '<p style="color: var(--color-slate-400); font-size: 0.875rem; text-align: center; padding: 1rem;">No meetings scheduled</p>';
        } else {
            monthMeetings.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(m => {
                const d = new Date(m.date);
                html += `
                    <div class="month-meeting-item" onclick="openMeetingModal('${m.id}')">
                        <div class="month-meeting-date">${d.getDate()}</div>
                        <div class="month-meeting-info">
                            <div class="month-meeting-title">${escapeHtml(m.title)}</div>
                            <div class="month-meeting-time">${m.time}</div>
                        </div>
                    </div>
                `;
            });
        }
        
        html += '</div>';
    });
    
    html += '</div>';
    container.innerHTML = html;
}

// ============================================================================
// MEETING MODAL
// ============================================================================

let currentMeetingId = null;

function openMeetingModal(meetingId) {
    currentMeetingId = meetingId;
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    
    if (!meeting) {
        console.error('Meeting not found:', meetingId);
        return;
    }
    
    const otherMeetings = dashboardData.meetings.filter(m => m.id !== meetingId);
    
    const modalHtml = `
        <div class="meeting-modal" id="meetingModalNew">
            <div class="meeting-modal-overlay" onclick="closeMeetingModalNew()"></div>
            <div class="meeting-modal-content">
                <div class="meeting-modal-header">
                    <div>
                        <div class="meeting-modal-title">${escapeHtml(meeting.title)}</div>
                        <div class="meeting-modal-subtitle">
                             ${meeting.dateFormatted || meeting.date} |  ${meeting.time}
                        </div>
                    </div>
                    <button class="meeting-modal-close" onclick="closeMeetingModalNew()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="meeting-modal-body">
                    <div class="form-group">
                        <label class="form-label"> Notes & Commentary</label>
                        <textarea class="form-textarea" id="meetingNotesNew" placeholder="Add meeting notes, agenda items, or commentary...">${escapeHtml(meeting.notes || '')}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Link Prep Session</label>
                        <select class="form-select" id="prepMeetingSelectNew">
                            <option value="">-- Select a prep meeting --</option>
                            ${otherMeetings.map(m => `<option value="${m.id}"${meeting.prepMeetingId === m.id ? ' selected' : ''}>${m.title} (${m.dateFormatted || m.date})</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Due Date for Deliverables</label>
                            <input type="date" class="form-input" id="deliverableDueDateNew" value="${meeting.deliverableDueDate || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Meeting Type</label>
                            <select class="form-select" id="meetingTypeNew">
                                <option value="Operational"${meeting.category === 'Operational' ? ' selected' : ''}>Operational</option>
                                <option value="Strategic"${meeting.category === 'Strategic' ? ' selected' : ''}>Strategic</option>
                                <option value="Governance"${meeting.category === 'Governance' ? ' selected' : ''}>Governance</option>
                                <option value="Review"${meeting.category === 'Review' ? ' selected' : ''}>Review</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Owner View</label>
                            <input type="text" class="form-input" id="ownerViewNew" value="${escapeHtml(meeting.owner || 'Exec1')}" placeholder="e.g., Exec1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Meeting Type</label>
                            <input type="text" class="form-input" id="meetingTypeTextNew" value="${escapeHtml(meeting.meetingType || 'Operational')}" placeholder="e.g., Operational">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"> Hyperlink</label>
                        <input type="url" class="form-input" id="meetingLinkNew" value="${escapeHtml(meeting.link || '')}" placeholder="https://example.com/meeting-materials">
                    </div>
                    
                    <div class="linked-docs-section">
                        <div class="linked-docs-header">
                            <span class="linked-docs-title"> Linked Documents</span>
                            <button class="add-link-btn" onclick="addLinkedDocumentNew()">+ Add Link</button>
                        </div>
                        <div id="linkedDocsListNew">
                            <p style="font-size: 0.75rem; color: var(--color-slate-400);">No documents linked yet.</p>
                        </div>
                    </div>
                </div>
                <div class="meeting-modal-footer">
                    <button class="btn-secondary" onclick="closeMeetingModalNew()">Close</button>
                    <button class="btn-primary" onclick="saveMeetingChangesNew()">Save Changes</button>
                </div>
            </div>
        </div>
    `;
    
    const existingModal = document.getElementById('meetingModalNew');
    if (existingModal) existingModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
}

function closeMeetingModalNew() {
    const modal = document.getElementById('meetingModalNew');
    if (modal) modal.remove();
    currentMeetingId = null;
}

function saveMeetingChangesNew() {
    if (!currentMeetingId) return;
    
    const notes = document.getElementById('meetingNotesNew').value;
    const prepMeetingId = document.getElementById('prepMeetingSelectNew').value;
    const deliverableDueDate = document.getElementById('deliverableDueDateNew').value;
    const meetingType = document.getElementById('meetingTypeNew').value;
    const ownerView = document.getElementById('ownerViewNew').value;
    const link = document.getElementById('meetingLinkNew').value;
    
    console.log('Saving meeting changes:', {
        meetingId: currentMeetingId,
        notes,
        prepMeetingId,
        deliverableDueDate,
        meetingType,
        ownerView,
        link
    });
    
    if (typeof google !== 'undefined' && google.script) {
        google.script.run
            .withSuccessHandler(() => {
                closeMeetingModalNew();
                loadDashboardData();
            })
            .withFailureHandler(err => {
                console.error('Failed to save:', err);
                alert('Failed to save changes. Please try again.');
            })
            .updateMeeting(currentMeetingId, {
                notes,
                prepMeetingId,
                deliverableDueDate,
                category: meetingType,
                owner: ownerView,
                link
            });
    } else {
        alert('Changes saved (preview mode)');
        closeMeetingModalNew();
    }
}

function addLinkedDocumentNew() {
    const url = prompt('Enter document URL:');
    if (url) {
        const name = prompt('Enter document name:') || 'Document';
        const container = document.getElementById('linkedDocsListNew');
        container.innerHTML = `
            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background-color: white; border-radius: 0.25rem; margin-bottom: 0.25rem;">
                 <a href="${url}" target="_blank">${escapeHtml(name)}</a>
            </div>
        `;
    }
}

function openNewMeetingModal() {
    alert('New meeting creation - coming soon!');
}

function exportMeetingsReport() {
    alert('Export report - coming soon!');
}

// Update switchPage to initialize meetings view
const originalSwitchPage = switchPage;
function switchPage(pageName) {
    currentPage = pageName;
    
    document.querySelectorAll('.page-content').forEach(page => {
        page.classList.add('hidden');
    });
    
    document.getElementById(pageName + 'Page').classList.remove('hidden');
    
    document.querySelectorAll('.page-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    if (event && event.target) {
        const tabBtn = event.target.closest('.page-tab');
        if (tabBtn) tabBtn.classList.add('active');
    }
    
    if (pageName === 'meetings') {
        switchMeetingsView(currentMeetingsView);
    } else if (pageName === 'documents' && document.getElementById('documentRepository').innerHTML.includes('Loading')) {
        renderDocumentRepository();
    }
}


// ============================================================================
// DELIVERABLE MODAL FUNCTIONALITY
// ============================================================================

function openDeliverableModal(id, description, eta, owner, link, comments, isHotTopic) {
    let modal = document.getElementById('deliverableModal');
    if (!modal) {
        createDeliverableModal();
        modal = document.getElementById('deliverableModal');
    }
    
    // Populate modal with EDITABLE data
    document.getElementById('modalDescription').value = description || '';
    document.getElementById('modalETA').value = eta || '';
    document.getElementById('modalOwner').value = owner || '';
    document.getElementById('modalLink').value = link || '';
    document.getElementById('modalComments').value = comments || '';
    document.getElementById('modalHotTopic').checked = isHotTopic === true || isHotTopic === 'true';
    
    // Store ID for saving
    modal.dataset.itemId = id;
    modal.dataset.itemType = 'deliverable';
    
    // Show modal
    modal.style.display = 'flex';
}

function createDeliverableModal() {
    const modalHTML = `
        <div id="deliverableModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;" onclick="closeDeliverableModal(event)">
            <div class="modal-content" style="background: white; border-radius: 1rem; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);" onclick="event.stopPropagation()">
                <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid var(--color-slate-200); display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <h3 style="font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <span> Deliverable Details</span>
                        </h3>
                    </div>
                    <button onclick="closeDeliverableModal()" style="background: none; border: none; cursor: pointer; padding: 0.5rem; color: var(--color-slate-500);">
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" style="padding: 1.5rem;">
                    <!-- Description -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Description</label>
                        <textarea id="modalDescription" style="width: 100%; min-height: 80px; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem; resize: vertical;" placeholder="Enter deliverable description..."></textarea>
                    </div>
                    
                    <!-- ETA and Owner Row -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> ETA</label>
                            <input type="text" id="modalETA" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem;" placeholder="e.g., 2026-01-30">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Owner</label>
                            <input type="text" id="modalOwner" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem;" placeholder="e.g., John Doe">
                        </div>
                    </div>
                    
                    <!-- Hyperlink -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Hyperlink</label>
                        <input type="url" id="modalLink" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem;" placeholder="https://example.com/document">
                    </div>
                    
                    <!-- Comments -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Comments</label>
                        <textarea id="modalComments" style="width: 100%; min-height: 80px; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem; resize: vertical;" placeholder="Add comments or notes..."></textarea>
                    </div>
                    
                    <!-- Hot Topic Checkbox -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: var(--color-slate-700); cursor: pointer;">
                            <input type="checkbox" id="modalHotTopic" style="width: 18px; height: 18px; cursor: pointer;">
                            <span> Mark as Hot Topic</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid var(--color-slate-200); background: var(--color-slate-50); display: flex; gap: 1rem; justify-content: space-between;">
                    <button onclick="deleteDeliverable()" style="padding: 0.75rem 1.5rem; border: 1px solid var(--color-red-300); background: white; color: var(--color-red-700); border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem;">
                        Delete
                    </button>
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="closeDeliverableModal()" style="padding: 0.75rem 1.5rem; border: 1px solid var(--color-slate-300); background: white; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem;">
                            Close
                        </button>
                        <button onclick="saveDeliverableChanges()" style="padding: 0.75rem 1.5rem; border: none; background: var(--color-red-700); color: white; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem;">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}



function addLinkedDocument() {
    const url = prompt('Enter document URL:');
    if (!url) return;
    
    const linkedDocsDiv = document.getElementById('modalLinkedDocs');
    const isEmpty = linkedDocsDiv.querySelector('p');
    if (isEmpty) linkedDocsDiv.innerHTML = '';
    
    const docHtml = `
        <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: white; border-radius: 0.375rem; border: 1px solid var(--color-slate-200); margin-bottom: 0.5rem;">
            <svg style="width: 16px; height: 16px; color: var(--color-slate-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <a href="${url}" target="_blank" style="flex: 1; color: var(--color-red-600); text-decoration: none; font-size: 0.875rem;">${url}</a>
            <button onclick="this.parentElement.remove()" style="background: none; border: none; cursor: pointer; padding: 0.25rem;">
                <svg style="width: 16px; height: 16px; color: var(--color-slate-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    `;
    linkedDocsDiv.insertAdjacentHTML('beforeend', docHtml);
}

function saveDeliverableChanges() {
    const modal = document.getElementById('deliverableModal');
    const itemId = modal.dataset.itemId;
    
    const data = {
        id: itemId,
        description: document.getElementById('modalDescription').value,
        eta: document.getElementById('modalETA').value,
        owner: document.getElementById('modalOwner').value,
        link: document.getElementById('modalLink').value,
        comments: document.getElementById('modalComments').value,
        isHotTopic: document.getElementById('modalHotTopic').checked
    };
    
    console.log('Saving deliverable changes:', data);
    
    if (typeof google !== 'undefined' && google.script) {
        google.script.run
            .withSuccessHandler(() => {
                alert('Changes saved successfully!');
                closeDeliverableModal();
                loadDashboardData();
            })
            .withFailureHandler((error) => {
                alert('Error saving changes: ' + error);
            })
            .updateDeliverable(data);
    } else {
        alert('Changes saved successfully! (Demo mode)');
        closeDeliverableModal();
    }
}


function closeDeliverableModal(event) {
    if (!event || event.target === event.currentTarget) {
        const modal = document.getElementById('deliverableModal');
        if (modal) modal.style.display = 'none';
    }
}

function deleteDeliverable() {
    if (!confirm('Are you sure you want to delete this deliverable?')) {
        return;
    }
    
    const modal = document.getElementById('deliverableModal');
    const itemId = modal.dataset.itemId;
    
    if (typeof google !== 'undefined' && google.script) {
        google.script.run
            .withSuccessHandler(() => {
                alert('Deliverable deleted successfully!');
                closeDeliverableModal();
                loadDashboardData();
            })
            .withFailureHandler((error) => {
                alert('Error deleting deliverable: ' + error);
            })
            .deleteDeliverable(itemId);
    } else {
        alert('Deliverable deleted successfully! (Demo mode)');
        closeDeliverableModal();
    }
}

function showCompletionOptions() {
    const modal = document.getElementById('deliverableModal');
    const itemId = modal.dataset.itemId;
    
    const choice = confirm('Where would you like to move this completed item?\n\nOK = Document Repository\nCancel = Executive Updates');
    
    const destination = choice ? 'Document Repository' : 'Executive Updates';
    
    // Call backend to mark complete and move item
    google.script.run
        .withSuccessHandler(() => {
            alert(`Item marked complete and moved to ${destination}`);
            closeDeliverableModal();
            loadDashboardData(); // Refresh data
        })
        .withFailureHandler((error) => {
            alert('Error completing item: ' + error);
        })
        .completeItem(itemId, destination);
}

// ============================================================================
// ADD NEW ITEM FUNCTIONALITY
// ============================================================================

function openAddItemModal(section) {
    const modal = document.getElementById('addItemModal');
    if (!modal) {
        createAddItemModal();
    }
    
    document.getElementById('addItemSection').value = section;
    document.getElementById('addItemForm').reset();
    modal.style.display = 'flex';
}

function createAddItemModal() {
    const modalHTML = `
        <div id="addItemModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;" onclick="closeAddItemModal(event)">
            <div class="modal-content" style="background: white; border-radius: 1rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);" onclick="event.stopPropagation()">
                <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid var(--color-slate-200); display: flex; align-items: center; justify-content: space-between;">
                    <h3 style="font-size: 1.25rem; font-weight: 700;">Add New Item</h3>
                    <button onclick="closeAddItemModal()" style="background: none; border: none; cursor: pointer; padding: 0.5rem; color: var(--color-slate-500);">
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <form id="addItemForm" onsubmit="submitNewItem(event)" style="padding: 1.5rem;">
                    <input type="hidden" id="addItemSection" value="">
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Description *</label>
                        <input type="text" id="addItemDescription" required style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">ETA</label>
                            <input type="date" id="addItemETA" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Owner</label>
                            <input type="text" id="addItemOwner" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Link (URL)</label>
                        <input type="url" id="addItemLink" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Comments</label>
                        <textarea id="addItemComments" rows="3" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="addItemHotTopic" style="width: 16px; height: 16px;">
                            <span style="font-weight: 600; color: var(--color-slate-700);"> Mark as Hot Topic</span>
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end; padding-top: 1rem; border-top: 1px solid var(--color-slate-200);">
                        <button type="button" onclick="closeAddItemModal()" style="padding: 0.5rem 1rem; border: 1px solid var(--color-slate-300); background: white; border-radius: 0.375rem; cursor: pointer; font-weight: 500;">
                            Cancel
                        </button>
                        <button type="submit" style="padding: 0.5rem 1rem; border: none; background: var(--color-red-600); color: white; border-radius: 0.375rem; cursor: pointer; font-weight: 500;">
                            Add Item
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function closeAddItemModal(event) {
    if (!event || event.target === event.currentTarget) {
        const modal = document.getElementById('addItemModal');
        if (modal) modal.style.display = 'none';
    }
}

function submitNewItem(event) {
    event.preventDefault();
    
    const itemData = {
        section: document.getElementById('addItemSection').value,
        description: document.getElementById('addItemDescription').value,
        eta: document.getElementById('addItemETA').value,
        owner: document.getElementById('addItemOwner').value,
        link: document.getElementById('addItemLink').value,
        comments: document.getElementById('addItemComments').value,
        isHotTopic: document.getElementById('addItemHotTopic').checked
    };
    
    // Call backend to add item
    google.script.run
        .withSuccessHandler(() => {
            alert('Item added successfully!');
            closeAddItemModal();
            loadDashboardData(); // Refresh data
        })
        .withFailureHandler((error) => {
            alert('Error adding item: ' + error);
        })
        .addNewItem(itemData);
}

// ============================================================================
// PDF EXPORT FUNCTIONALITY
// ============================================================================

function openPDFExportModal() {
    const modal = document.getElementById('pdfExportModal');
    modal.classList.remove('hidden');
    
    // Populate meetings list
    const meetingsList = document.getElementById('pdfMeetingsList');
    
    if (!dashboardData.meetings || dashboardData.meetings.length === 0) {
        meetingsList.innerHTML = '<p style="color: var(--color-slate-500); text-align: center; padding: 1rem;">No meetings available</p>';
        return;
    }
    
    // Detect conflicts
    const meetingsByDate = {};
    dashboardData.meetings.forEach(m => {
        if (!meetingsByDate[m.date]) {
            meetingsByDate[m.date] = [];
        }
        meetingsByDate[m.date].push(m);
    });
    
    // Mark conflicts
    for (const date in meetingsByDate) {
        const timeSlots = {};
        meetingsByDate[date].forEach(m => {
            const timeKey = m.time || '00:00';
            if (!timeSlots[timeKey]) {
                timeSlots[timeKey] = [];
            }
            timeSlots[timeKey].push(m);
        });
        
        for (const timeKey in timeSlots) {
            if (timeSlots[timeKey].length > 1) {
                timeSlots[timeKey].forEach(m => {
                    m.hasConflict = true;
                });
            }
        }
    }
    
    // Render meetings list
    meetingsList.innerHTML = dashboardData.meetings.map(m => `
        <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid var(--color-slate-100); cursor: pointer;">
            <input type="checkbox" class="pdf-meeting-checkbox" value="${m.id}" checked>
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 0.875rem;">
                    ${escapeHtml(m.title)}
                    ${m.hasConflict ? '<span style="color: var(--color-red-600); margin-left: 0.5rem;"> CONFLICT</span>' : ''}
                </div>
                <div style="font-size: 0.75rem; color: var(--color-slate-500);">
                    ${m.dateFormatted || ''} at ${m.time || 'TBD'}
                    ${m.prepRequired ? '   Prep Required' : ''}
                </div>
            </div>
        </label>
    `).join('');
}

function closePDFExportModal() {
    const modal = document.getElementById('pdfExportModal');
    modal.classList.add('hidden');
}

function generatePDFExport() {
    const title = document.getElementById('pdfWeekTitle').value || 'Weekly Schedule';
    const includePrepMeetings = document.getElementById('pdfPrepMeetings').checked;
    const selectedMeetings = Array.from(document.querySelectorAll('.pdf-meeting-checkbox:checked')).map(cb => cb.value);
    
    if (selectedMeetings.length === 0) {
        alert('Please select at least one meeting to export');
        return;
    }
    
    // Show loading state
    const exportBtn = event.target;
    const originalText = exportBtn.innerHTML;
    exportBtn.disabled = true;
    exportBtn.innerHTML = '<svg class="icon" style="width: 1rem; height: 1rem; animation: spin 1s linear infinite;"></svg> Generating...';
    
    // Call backend to generate PDF
    google.script.run
        .withSuccessHandler((result) => {
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
            
            if (result.success) {
                // Open the PDF in a new tab
                window.open(result.downloadUrl, '_blank');
                closePDFExportModal();
            } else {
                alert('Error generating PDF: ' + (result.error || 'Unknown error'));
            }
        })
        .withFailureHandler((error) => {
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
            alert('Error: ' + error);
        })
        .generateWeeklySchedulePDF({
            weekTitle: title,
            includePrepMeetings: includePrepMeetings,
            selectedMeetingIds: selectedMeetings
        });
}



</script>
</body>
</html>
